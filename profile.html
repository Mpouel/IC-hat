<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IC hat - By Geoloup team</title>
    <link rel="shortcut icon" href="img/ic-hat.png">
    <link href="style.css" rel="stylesheet">
    <link href="profile.css" rel="stylesheet">
    <link href="" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.13.0/firebase-app-compat.js"></script>
</head>

<body>
    <div>
        <div id="wait-connected">
            <div class="loader">
                <h2>Loading your profile</h2>
            </div>
            <div class="loader-div-img"></div>
            <div class="loader-line-mask">
                <div class="loader-line"></div>
            </div>
        </div>
        <div id="not-connected"><iframe class="not-connected-iframe" id="not-connected-iframe" src="home.html"></iframe>
            <script src="login-register.js"></script>
        </div>
        <div id="connected">
            <div class="container">
                <img src="" alt="Avatar" class="image" id="user_pic" style="width:100%">
                <div id="box" class="middle">
                    <div class="text">Change image</div>
                </div>
            </div>
            <button onclick="window.location.replace('https:' + '/' + '/' + window.location.host)">Back to
                IC-hat</button>
            <button id="user_pic_ready"></button>
            <div class="container">
                <h1>Crop a round image</h1>
                <h3>Image</h3>
                <div>
                    <img id="image" src="image.jpeg" alt="Picture">
                </div>
                <h3>Result</h3>
                <p>
                    <button type="button" id="button">Crop</button>
                </p>
                <div id="result"></div>
                <script src="crop.profile.js"></script>
                <script src="profile.js" type="module"></script>
                <script>    function getRoundedCanvas(sourceCanvas) {
                        var canvas = document.createElement('canvas');
                        var context = canvas.getContext('2d');
                        var width = sourceCanvas.width;
                        var height = sourceCanvas.height;

                        canvas.width = width;
                        canvas.height = height;
                        context.imageSmoothingEnabled = true;
                        context.drawImage(sourceCanvas, 0, 0, width, height);
                        context.globalCompositeOperation = 'destination-in';
                        context.beginPath();
                        context.arc(width / 2, height / 2, Math.min(width, height) / 2, 0, 2 * Math.PI, true);
                        context.fill();
                        return canvas;
                    }

                    window.addEventListener('DOMContentLoaded', function () {
                        var image = document.getElementById('image');
                        var button = document.getElementById('button');
                        var result = document.getElementById('result');
                        var croppable = false;
                        var cropper = new Cropper(image, {
                            aspectRatio: 1,
                            viewMode: 1,
                            ready: function () {
                                croppable = true;
                            },
                        });

                        button.onclick = function () {
                            var croppedCanvas;
                            var roundedCanvas;
                            var roundedImage;

                            if (!croppable) {
                                return;
                            }

                            // Crop
                            croppedCanvas = cropper.getCroppedCanvas();

                            // Round
                            roundedCanvas = getRoundedCanvas(croppedCanvas);

                            // Show
                            roundedImage = document.createElement('img');
                            roundedImage.src = roundedCanvas.toDataURL()
                            result.innerHTML = '';
                            result.appendChild(roundedImage);
                        };
                    });</script>
            </div>
        </div>
</body>

</html>